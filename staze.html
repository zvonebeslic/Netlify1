<!DOCTYPE html>
<html lang="hr">
<head>
  <!-- =========================================================
       #01 META / ASSETI
       ========================================================= -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Mountain Adventures — Staze</title>

  <meta
    name="description"
    content="Istraži planinarske staze Balkana. Filtriraj po težini (km/nadmorska), planini/području, trajanju i udaljenosti od tvoje lokacije. GPX tragovi i sažeti opisi."
  />

  <link rel="icon" href="images/mountain-adventures.svg" type="image/svg+xml" />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="season.css" />

  <!-- =========================================================
       #02 STILOVI (čitko, red po red)
       ========================================================= -->
  <style>
    :root {
      --bg: #0b1110;
      --ink: #e8f1ed;
      --muted: #b7c7c0;
      --panel: #0f1a15;
      --panel-2: #0e1714;
      --line: rgba(255, 255, 255, 0.10);
      --brand: #2e7d5b;
      --brand-2: #3d9c73;
      --chip: #16231d;

      --diff-veryeasy-bg: #0f2c22;
      --diff-veryeasy-ink: #7ad8a1;
      --diff-easy-bg: #102638;
      --diff-easy-ink: #7fbaf2;
      --diff-medium-bg: #2a2914;
      --diff-medium-ink: #f3d36b;
      --diff-hard-bg: #331f12;
      --diff-hard-ink: #ffa066;
      --diff-extreme-bg: #351616;
      --diff-extreme-ink: #ff6b6b;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      overflow-x: hidden;
    }

    body {
      font-family: Montserrat, Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
      scroll-behavior: smooth;
    }

    a {
      color: #9fe1c5;
      text-decoration: none;
    }

    .container {
      max-width: 1150px;
      margin: 0 auto;
      padding: 0 14px;
    }

    /* =========================================================
       NAVBAR
       ========================================================= */
    .navbar {
      position: fixed;
      z-index: 1000;
      top: 0;
      right: 0;
      left: 0;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 15px;
      border-bottom: 1px solid var(--line);
      background: rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(8px);
    }

    .navbar-left img {
      position: relative;
      height: 16px;
      width: 24px;
      cursor: pointer;
    }

    .navbar-left img:hover::after {
      position: absolute;
      top: 30px;
      left: 0;
      content: attr(data-tooltip);
      padding: 4px 8px;
      border-radius: 5px;
      background: #ffffff;
      color: #000;
      font-size: 12px;
      white-space: nowrap;
      box-shadow: 0 0 6px rgba(0, 0, 0, .2);
    }

.navbar-center {
  flex: 1;
  display: flex;
  justify-content: center;
  z-index: 1;
  transform: translateY(12px);
}

.search-container {
  width: 250px;
  position: relative;
  padding-top: 10px;
  z-index: 1;
}

.search-wrapper {
  position: relative;
  z-index: 2;
  width: 100%;
  height: 30px; /* ili 55px ako dodaješ prostor za sliku */
  background: #fff;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
  padding: 0 15px;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  overflow: visible;
  border-radius: 20px;
}

/* === UKRASNA PLANINA IZNAD TRAŽILICE === */
.search-top-decoration {
  position: absolute;
  top: -212.7px;
  left: 108px;
  width: 1600%;
  height: 30px;
  object-fit: cover;
  display: block;
  z-index: -10;
  transform: scale(19);
  transform-origin: top center;
  pointer-events: none;
}
      
/* === UNUTARNJI INPUT POLJE === */
.mountain-search {
  width: 100%;
  padding: 14px 40px 8px 12px;
  font-size: 14px;
  border: none;
  background: transparent;
  color: #333;
  outline: none;
}

/* === IKONA UNUTAR TRAŽILICE === */
.search-wrapper img {
  position: absolute;
  right: 12px;
  bottom: 8px;
  width: 19px;
  height: 19px;
  pointer-events: none;
}

    .navbar-right {
      display: flex;
      flex-direction: column;
      gap: 5px;
      padding: 8px;
      border: 1px solid rgba(255, 255, 255, .35);
      border-radius: 8px;
      background: rgba(255, 255, 255, .05);
      cursor: pointer;
    }

    .burger-line {
      width: 26px;
      height: 3px;
      border-radius: 2px;
      background: #fff;
    }

.menu-overlay {
  position: fixed;
  top: 70px;
  right: 0;
  width: 35vw;
  background-color: rgba(17, 17, 17, 0.95);
  color: white;
  padding: 20px;
  display: none;
  flex-direction: column;
  align-items: flex-start;
  z-index: 9999;
}

.menu-overlay.open {
  display: flex;
}

.menu-overlay a {
  margin: 10px 0;
  text-decoration: none;
  color: white;
  font-size: 1.1em;
}

    /* =========================================================
       HERO + NASLOV
       ========================================================= */
    .image-section {
      position: relative;
      height: 50vh;
      background: url('images/hero.jpg') center / cover no-repeat;
    }

    .overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(0, 0, 0, .35), rgba(0, 0, 0, .55));
    }

    main .header {
      text-align: center;
      padding: 16px;
      border-bottom: 1px solid var(--line);
      border-radius: 16px;
      background: linear-gradient(180deg, #101b16, #0e1814);
    }

    main .header h1 {
      font-size: clamp(14px, 2.3vw, 19px);
      letter-spacing: .2px;
    }

    main .header p {
      margin-top: 8px;
      color: var(--muted);
      font-size: clamp(8px, 1.6vw, 10px);
    }

    /* =========================================================
       FILTERI — lijevo tab-gumbi (usko), desno panel (kompakt)
       ========================================================= */
    .filters-wrap {
      display: grid;
      grid-template-columns: 108px 1fr;
      gap: 10px;
      width: 100%;
      padding: 10px;
      border: 1px solid var(--line);
      border-radius: 14px;
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      box-shadow: 0 8px 24px rgba(0, 0, 0, .25);
      color: var(--ink);
    }

    .filters-left {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .filter-tab {
      width: 100%;
      text-align: left;
      padding: 6px 8px;
      border: 1px solid var(--line);
      border-radius: 9px;
      background: #121418;
      color: var(--ink);
      font-size: 12px;
      line-height: 1;
      letter-spacing: .2px;
      outline: none;
      transition: background .2s, border-color .2s, transform .04s;
    }

    .filter-tab:active {
      transform: scale(.985);
    }

    .filter-tab.active {
      background: linear-gradient(180deg, #152028, #12171d);
      border-color: #35404a;
    }

    .filters-actions {
      margin-top: 6px;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .btn-apply,
    .btn-reset {
      flex: 1 1 auto;
      padding: 6px 8px;
      border: 1px solid var(--line);
      border-radius: 9px;
      background: #121418;
      color: var(--ink);
      font-size: 12px;
      line-height: 1;
    }

    .btn-apply {
      background: linear-gradient(180deg, var(--brand), var(--brand-2));
      border-color: #1f815a;
      color: #fff;
      font-weight: 700;
    }

    .filters-right {
      padding: 10px;
      border: 1px solid var(--line);
      border-radius: 12px;
      min-height: 120px;
      background: #111418;
    }

    .panel {
      display: none;
    }

    .panel.active {
      display: block;
    }

    .panel-title {
      margin-bottom: 6px;
      color: var(--muted);
      font-size: 12px;
      font-weight: 700;
      letter-spacing: .2px;
    }

    .chips {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-start;
    }

    .chip {
      padding: 6px 8px;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: #20252c;
      color: var(--ink);
      font-size: 12px;
      line-height: 1;
    }

    .chip input {
      display: none;
    }

    .chip.active {
      background: #2b3440;
      border-color: #39424c;
    }

    .field {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .field label {
      min-width: 84px;
      color: var(--muted);
      font-size: 12px;
    }

    .select,
    .range,
    .button-slim {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid var(--line);
      border-radius: 9px;
      background: #0f1216;
      color: var(--ink);
      font-size: 12px;
      line-height: 1.1;
    }

    .hint {
      margin-top: 6px;
      font-size: 11px;
      color: var(--muted);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border: 1px solid #28303a;
      border-radius: 999px;
      background: #101419;
      color: #cde6d9;
      font-size: 11px;
      line-height: 1;
    }

    /* =========================================================
       LISTA STAZA — „prvi dan” kompakt
       ========================================================= */
    .trail-list {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 18px;
      justify-content: center;
      margin: 20px auto;
    }

    @media (max-width: 760px) {
      .trail-list {
        grid-template-columns: 1fr;
      }
    }

    .trail-card {
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 12px;
      background: #0f1a15;
      overflow: hidden;
      transition: transform .15s ease, box-shadow .15s ease;
    }

    .trail-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, .25);
    }

    .trail-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      background: #0e1714;
    }

    .trail-card .pad {
      padding: 10px;
    }

    .title-line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .title-line h3 {
      margin: 0;
      font-size: 15px;
      font-weight: 700;
      letter-spacing: .2px;
    }

    .dist-chip {
      padding: 3px 7px;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: #13231c;
      color: #cfe9de;
      font-size: 11px;
      white-space: nowrap;
      line-height: 1;
    }

    .metric-row {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 8px;
      padding: 6px 0;
      border-top: 1px dashed rgba(255, 255, 255, .08);
    }

    .metric-row:first-of-type {
      border-top: 0;
    }

    .metric-label {
      font-size: 12px;
      font-weight: 700;
      opacity: .95;
    }

    .metric-value {
      justify-self: start;
      opacity: .95;
      font-size: 12px;
    }

    .diff-pill {
      padding: 3px 7px;
      border: 1px solid var(--line);
      border-radius: 999px;
      font-size: 11px;
      white-space: nowrap;
      line-height: 1;
    }

    .diff-pill.very-easy {
      background: var(--diff-veryeasy-bg);
      color: var(--diff-veryeasy-ink);
    }

    .diff-pill.easy {
      background: var(--diff-easy-bg);
      color: var(--diff-easy-ink);
    }

    .diff-pill.medium {
      background: var(--diff-medium-bg);
      color: var(--diff-medium-ink);
    }

    .diff-pill.hard {
      background: var(--diff-hard-bg);
      color: var(--diff-hard-ink);
    }

    .diff-pill.extreme {
      background: var(--diff-extreme-bg);
      color: var(--diff-extreme-ink);
    }

    .card-desc {
      margin-top: 8px;
      color: #cfe1d9;
      line-height: 1.4;
      font-size: 12px;
    }

    .card-footer {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px dashed rgba(255, 255, 255, .08);
      color: var(--muted);
      font-size: 11px;
    }

    /* =========================================================
       FOOTER / BACK TO TOP
       ========================================================= */
    #backToTop {
      position: fixed;
      z-index: 9999;
      bottom: 22px;
      left: 50%;
      transform: translateX(-50%);
      display: none;
      align-items: center;
      justify-content: center;
      width: 48px;
      height: 48px;
      border: 1px solid rgba(255, 255, 255, .25);
      border-radius: 50%;
      background: rgba(255, 255, 255, .15);
      color: #fff;
      backdrop-filter: blur(12px);
    }

    footer {
      text-align: center;
      padding: 20px 10px;
      margin-top: 40px;
      border-top: 1px solid var(--line);
      background: #0e1714;
      color: #bcd0c7;
    }

    .footer-icons svg {
      width: 32px;
      height: 32px;
      margin: 0 10px;
      opacity: .85;
    }
  </style>
</head>

<body>

<!-- === NAVIGACIJA (gore) === -->
  <div class="navbar">
    <div class="navbar-left">
      <img src="images/flag-uk.svg" alt="promjena jezika na engleski" id="language-toggle" data-tooltip="Promijeni jezik">
    </div>
    <div class="navbar-center">
      <div class="search-container">
        <div class="search-wrapper">
          <img src="images/planine-za-trazilicu.png" alt="planinski-vrhovi" class="search-top-decoration" />
          <input type="text" class="mountain-search" id="search" placeholder="Pretraži...">
          <img src="images/search.svg" alt="ikona za tražilicu">
        </div>
      </div>
    </div>
    <div class="navbar-right" id="menu-toggle">
      <div class="burger-line"></div>
      <div class="burger-line"></div>
      <div class="burger-line"></div>
    </div>
  </div>

  <!-- === HAMBURGER MENI === -->
  <div class="menu-overlay" id="menu">
    <a href="index.html" data-hr="Naslovna" data-en="Home">Naslovna</a>
    <a href="staze.html" data-hr="Staze" data-en="Trails">Staze</a>
    <a href="avantura.html" data-hr="Avantura" data-en="Adventure">Avantura</a>
    <a href="webshop.html" data-hr="Web shop" data-en="Web Shop">Web shop</a>
    <a href="planinarskevijesti.html" data-hr="Blog" data-en="Blog">Blog</a>
    <a href="digitalniruksak.html" data-hr="Digitalni ruksak" data-en="Digital backpack">Digitalni ruksak</a>
    <a href="kontakt.html" data-hr="Kontakt" data-en="Contact">Kontakt</a>
  </div>

  <!-- === SEASON TOGGLE IKONE === -->
<div id="season-toggle-wrapper">
  <img src="images/seasonchange.svg" id="season-toggle" alt="odabir godišnjeg doba" />
  <div id="season-strike" class="hidden"></div> <!-- KOSA CRTA -->
  <div id="season-icons">
    <div class="season-icon" data-season="winter">❄️</div>
    <div class="season-icon" data-season="spring">🌸</div>
    <div class="season-icon" data-season="summer">☀️</div>
    <div class="season-icon" data-season="autumn">🍂</div>
  </div>
 </div>
  
  <!-- HERO -->
  <section class="image-section">
    <div class="overlay"></div>
  </section>

  <main class="container">
    <section class="header">
      <h1>Istražte planinarske staze</h1>
      <p>Pronađite svoju turu prema težini (km/nmv), planini/području, vremenu hodanja ili udaljenosti od vaše lokacije.</p>
    </section>

    <!-- FILTERI (Lijevo: mali gumbi; Desno: mali paneli) -->
    <section class="filters-wrap" style="margin-top:14px;">
      <!-- lijevo -->
      <div class="filters-left">
        <button class="filter-tab active" data-panel="panel-diff">Težina</button>
        <button class="filter-tab" data-panel="panel-radius">Udaljenost</button>
        <button class="filter-tab" data-panel="panel-area">Područje</button>
        <button class="filter-tab" data-panel="panel-duration">Trajanje</button>
        <button class="filter-tab" data-panel="panel-poi">Tražilica</button>

        <div class="filters-actions">
          <button id="applyFilters" class="btn-apply" type="button">Primijeni</button>
          <button id="quickReset" class="btn-reset" type="button">Osvježi</button>
        </div>
      </div>

      <!-- desno -->
      <div class="filters-right">
        <!-- TEŽINA -->
        <div id="panel-diff" class="panel active">
  <div class="panel-title">Ocijeni po kilometraži i/ili nadmorskoj visini</div>

  <div class="field">
    <label>Uključi</label>
    <div style="display:flex; gap:8px; flex-wrap:wrap;">
      <label class="badge"><input id="modeKm" type="checkbox" checked /> km</label>
      <label class="badge"><input id="modeElev" type="checkbox" checked /> nm/v</label>
    </div>
  </div>

  <div class="chips" style="margin-top:6px;">
    <label class="chip"><input class="diff-chip" type="checkbox" value="Easy" /> Lako</label>
    <label class="chip"><input class="diff-chip" type="checkbox" value="Moderate" /> Umjereno</label>
    <label class="chip"><input class="diff-chip" type="checkbox" value="Challenging" checked /> Zahtjevno</label>
    <label class="chip"><input class="diff-chip" type="checkbox" value="Hard" /> Jako teško</label>
    <label class="chip"><input class="diff-chip" type="checkbox" value="Extreme" /> Ekstremno</label>
  </div>

  <p class="hint">Savjet: uključi “km” i/ili “nm/v”. Ako su oba filtera uključena, prikazuju se staze koje zadovolje barem jedan od njih.</p>
</div>

        <!-- UDALJENOST -->
        <div id="panel-radius" class="panel">
          <div class="panel-title">Udaljenost od vaše lokacije</div>
          <div class="field">
            <label for="radiusSelect">Radijus</label>
            <select id="radiusSelect" class="select">
              <option value="">Bez ograničenja</option>
              <option value="100">Do 100 km</option>
              <option value="200">Do 200 km</option>
              <option value="300">Do 300 km</option>
              <option value="400">Do 400 km</option>
              <option value="500">Do 500 km</option>
            </select>
          </div>
          <div class="field">
            <label for="distanceMode">Mjerenje</label>
            <select id="distanceMode" class="select">
              <option value="air" selected>Zračna linija (preporučeno)</option>
              <option value="drive">Vožnja autom (beta)</option>
            </select>
          </div>
          <p class="hint">Dopusti lokaciju za automatski prikaz “XX km od vas” na svakoj kartici.</p>
        </div>

        <!-- PODRUČJE -->
        <div id="panel-area" class="panel">
          <div class="panel-title">Planina / područje</div>
          <div class="field">
            <label for="areaSelect">Lokacija</label>
            <select id="areaSelect" class="select">
              <option value="">Sve lokacije</option>
            </select>
          </div>
        </div>

        <!-- TRAJANJE -->
        <div id="panel-duration" class="panel">
          <div class="panel-title">Vrijeme hodanja</div>
          <div class="field">
            <label for="durationBucket">Trajanje</label>
            <select id="durationBucket" class="select">
              <option value="">Bilo koje</option>
              <option value="3">Do 3 h</option>
              <option value="5">Do 5 h</option>
              <option value="8">Do 8 h</option>
              <option value="10">Do 10 h</option>
              <option value=">10">Preko 10 h</option>
            </select>
          </div>
        </div>

        <!-- TRAŽILICA (POI) -->
        <div id="panel-poi" class="panel">
          <div class="panel-title">Tražilica odredišta (vrh/mjesto)</div>
          <input id="poiSearch" class="select" type="search" placeholder="npr. Hajdučka Vrata, Kredarica" />
        </div>
      </div>
    </section>

    <!-- AKTIVNI ČIPOVI -->
    <section id="activeChips" class="active-chips" style="margin-top:12px;"></section>

    <!-- LISTA STAZA -->
    <section id="trail-list" class="trail-list"></section>
  </main>

  <!-- FOOTER + BACK TO TOP -->
  <button id="backToTop" title="Na vrh" aria-label="Gumb na vrh">
    <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <polyline points="18 15 12 9 6 15"></polyline>
    </svg>
  </button>

  <footer id="footer" class="container">
    <div class="footer-icons">
      <a href="https://instagram.com/mountainadventures__" target="_blank" aria-label="Instagram">
        <svg viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
          <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
          <line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line>
        </svg>
      </a>
      <a href="mailto:mountainadventures1717@gmail.com" aria-label="Email">
        <svg viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
          <polyline points="22,6 12,13 2,6"></polyline>
        </svg>
      </a>
    </div>
    © Mountain Adventures. All rights reserved.
  </footer>

  <!-- =========================================================
       #10 SCRIPTS
       ========================================================= -->
  <script src="season.js"></script>
  <script src="popis-staza.js"></script>

  <script>
    /* ---------------------------------------------------------
       #10.1 NAV / JEZIK / MENI / BACK-TO-TOP
       --------------------------------------------------------- */
    const langToggle = document.getElementById('language-toggle');
    const searchInput = document.getElementById('search');
    const menuToggle = document.getElementById('menu-toggle');
    const menu = document.getElementById('menu');
    const backToTopBtn = document.getElementById('backToTop');
    const footer = document.getElementById('footer');

    function getInitialLang() {
      const urlLang = new URLSearchParams(location.search).get('lang');
      if (['hr', 'en'].includes(urlLang)) return urlLang;
      try { const s = localStorage.getItem('preferredLang'); if (['hr','en'].includes(s)) return s; } catch(e){}
      return 'hr';
    }

    function applyLanguage(lang) {
      try { localStorage.setItem('preferredLang', lang); } catch(e){}
      const u = new URL(location.href); u.searchParams.set('lang', lang); history.replaceState({}, '', u.toString());
      document.documentElement.lang = lang;

      if (langToggle) {
        langToggle.src = lang === 'hr' ? 'images/flag-uk.svg' : 'images/flag-hr.svg';
        langToggle.alt = lang === 'hr' ? 'Promijeni na engleski' : 'Switch to Croatian';
        langToggle.setAttribute('data-tooltip', lang === 'hr' ? 'Promijeni jezik' : 'Change language');
      }
      if (searchInput) searchInput.placeholder = lang === 'hr' ? 'Pretraži...' : 'Search...';

      document.querySelectorAll('[data-hr]').forEach(el => {
        const v = el.getAttribute('data-' + lang);
        if (v == null) return;
        if (v.includes('<')) el.innerHTML = v; else el.textContent = v;
      });
      document.querySelectorAll('.menu-overlay a').forEach(a => {
        const v = a.getAttribute('data-' + lang); if (v != null) a.textContent = v;
      });
    }

    let currentLang = getInitialLang();
    applyLanguage(currentLang);
    if (langToggle) langToggle.addEventListener('click', () => { currentLang = currentLang === 'hr' ? 'en' : 'hr'; applyLanguage(currentLang); });

    menuToggle.addEventListener('click', () => { menu.classList.toggle('open'); });
    window.addEventListener('click', (e) => { if (!menu.contains(e.target) && !menuToggle.contains(e.target) && e.target.id !== 'language-toggle') menu.classList.remove('open'); });
    document.querySelectorAll('.menu-overlay a').forEach(l => l.addEventListener('click', () => menu.classList.remove('open')));

    window.addEventListener('scroll', () => {
      const y = window.scrollY; const footerTop = footer.getBoundingClientRect().top + window.scrollY; const h = window.innerHeight;
      backToTopBtn.style.display = y > 300 ? 'flex' : 'none';
      backToTopBtn.style.bottom = (y + h > footerTop) ? ((y + h - footerTop) + 60) + 'px' : '30px';
    });
    backToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

    document.addEventListener('DOMContentLoaded', () => {
      const s = localStorage.getItem('activeSeason');
      if (s) {
        setTimeout(() => {
          if (s === 'winter') startWinterEffect(true);
          else if (s === 'summer') startSummerEffect(true);
          else if (s === 'spring') startSpringEffect(true);
          else if (s === 'autumn') startAutumnEffect(true);
        }, 10000);
      }
      fetch('season.html').then(r => r.text()).then(html => {
        const ph = document.getElementById('season-placeholder'); if (ph) ph.innerHTML = html;
        if (typeof initializeSeasonToggle === 'function') initializeSeasonToggle();
      }).catch(() => {});
    });

    /* ---------------------------------------------------------
       #10.2 TEŽINSKE KATEGORIJE
       --------------------------------------------------------- */
    const DIFF_LABELS = {
      'Easy': 'Lako',
      'Moderate': 'Umjereno',
      'Challenging': 'Zahtjevno',
      'Hard': 'Jako teško',
      'Extreme': 'Ekstremno'
    };
    function classifyByKm(km){ if (km <= 4) return 'Easy'; if (km <= 8) return 'Moderate'; if (km <= 14) return 'Challenging'; if (km <= 18) return 'Hard'; return 'Extreme'; }
    function classifyByElev(m){ if (m <= 100) return 'Easy'; if (m <= 300) return 'Moderate'; if (m <= 800) return 'Challenging'; if (m <= 1300) return 'Hard'; return 'Extreme'; }
    const norm = (s)=> (s||'').toString().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');

    /* ---------------------------------------------------------
       #10.3 GEOLOKACIJA + UDALJENOSTI
       --------------------------------------------------------- */
    let userLocation = null, geoTried = false, distancesEnabled = false;
    function ensureGeolocationOnce(force=false){
      return new Promise((res)=>{
        if (userLocation) return res(userLocation);
        if (geoTried && !force) return res(null);
        geoTried = true;
        if (!('geolocation' in navigator)) return res(null);
        navigator.geolocation.getCurrentPosition(
          (pos)=>{ userLocation={lat:pos.coords.latitude, lon:pos.coords.longitude}; distancesEnabled=true; res(userLocation); },
          _=> res(null),
          { enableHighAccuracy:true, timeout:12000, maximumAge:120000 }
        );
      });
    }
    function haversineKm(lat1,lon1,lat2,lon2){
      const R=6371, toRad=d=>d*Math.PI/180;
      const dLat=toRad(lat2-lat1), dLon=toRad(lon2-lon1);
      const a=Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
      return 2*R*Math.asin(Math.sqrt(a));
    }
    const driveCache=new Map();
    const withTimeout=(p,ms=6000)=>Promise.race([p,new Promise((_,rej)=>setTimeout(()=>rej(new Error('timeout')),ms))]);
    async function drivingDistanceKm(origin,dest){
      if (!origin||!dest) return null;
      const key=`${origin.lat},${origin.lon}->${dest.lat},${dest.lon}`;
      if (driveCache.has(key)) return driveCache.get(key);
      const url=`https://router.project-osrm.org/route/v1/driving/${origin.lon},${origin.lat};${dest.lon},${dest.lat}?overview=false`;
      try{
        const resp=await withTimeout(fetch(url),6000);
        if(!resp.ok) throw new Error('bad status');
        const data=await resp.json();
        const m=data?.routes?.[0]?.distance;
        const km=(typeof m==='number')? m/1000 : null;
        if(km!=null) driveCache.set(key,km);
        return km;
      }catch(_){ return null; }
    }

    /* ---------------------------------------------------------
       #10.4 PODRUČJA (AREAS)
       --------------------------------------------------------- */
    const AREAS = [
      'Triglav','Velebit','Begunjščica','Klekovača','Sljeme','Medvednica','Dinara','Oštrovača','Šator','Kozara',
      'Ivanščica','Kamešnica','Cincar','Vranica','Matinski Vis','Zavelim','Golija','Stožer','Ljubuša','Tušnica',
      'Svilaja','Biokovo','Mosor','Raduša','Vran','Čvrsnica','Čabulja','Prenj','Crvanj','Matokit','Velež','Visočica',
      'Bjelašnica','Treskavica','Zelengora','Volujak','Maglić','Lelija','Durmitor','Komovi','Prokletije','Šar planina',
      'Otok Pag','Poluotok Pelješac','Šipovo','Otok Hvar','Otok Brač','Kanjon Badnjevice','Oštrc','Učka','Risnjak',
      'Snježnik (HR)','Papuk','Psunj','Kalnik','Ugljan','Krk','Cres','Mljet','Nanos','Snežnik (SLO)',
      'Stol (Karavanke)','Krn','Grintovec','Velika planina','Vitosha','Rila','Pirin','Balkan (Stara planina BG)',
      'Rhodope','Osogovo','Belasica','Strandzha','Kopaonik','Stara planina (RS)','Rtanj','Suva planina','Zlatibor',
      'Tara','Fruška gora','Rudnik','Jastrebac','Maljen (Divčibare)','Homolje','Kuјачke planine','Orjen','Lovćen',
      'Rumija','Bjelasica','Sinjajevina','Korab','Pelister','Jablanica planina','Kozuf','Jakupica (Solunska Glava)',
      'Bistra (Mavrovo)','Dajti','Tomorr','Cika (Llogara)','Gjallica','Smolikas','Tymfi (Gamila)','Olymp','Vihren (Pirin)',
      'Musala (Rila)','Cherni Vrah (Vitosha)','Botev (Balkan BG)','Taygetus'
    ];
    (function fillAreas(){
      const sel=document.getElementById('areaSelect');
      AREAS.forEach(a=>{ const o=document.createElement('option'); o.value=a; o.textContent=a; sel.appendChild(o); });
    })();

    /* ---------------------------------------------------------
       #10.5 STATE
       --------------------------------------------------------- */
    const filterState = {
  area: '',
  radius: '',
  duration: '',
  modeKm: true,
  modeElev: true,
  chipsSel: ['medium'],
  poi: '',
  distanceMode: 'air'
};

    function stateFromControls(){
  const chips = [...document.querySelectorAll('.diff-chip:checked')].map(i => i.value);
  return {
    area: document.getElementById('areaSelect')?.value || '',
    radius: document.getElementById('radiusSelect')?.value || '',
    duration: document.getElementById('durationBucket')?.value || '',
    poi: document.getElementById('poiSearch')?.value?.trim() || '',
    modeKm: document.getElementById('modeKm')?.checked ?? true,
    modeElev: document.getElementById('modeElev')?.checked ?? true,
    chipsSel: chips,
    distanceMode: document.getElementById('distanceMode')?.value || 'air'
  };
}
    function updateFilterState(ns){ Object.assign(filterState, ns); }

    /* ---------------------------------------------------------
       #10.6 AKTIVNI ČIPOVI
       --------------------------------------------------------- */
    function renderActiveChips(){
      const host = document.getElementById('activeChips'); host.innerHTML='';
      function addChip(label, onRemove){
        const chip=document.createElement('span'); chip.className='chip';
        chip.innerHTML = `${label} <button type="button" aria-label="Ukloni">×</button>`;
        chip.querySelector('button').addEventListener('click', onRemove);
        host.appendChild(chip);
      }
      if (filterState.area) addChip(`Lokacija: ${filterState.area}`, ()=>{ document.getElementById('areaSelect').value=''; updateFilterState({area:''}); runFiltering(); });
      if (filterState.radius) addChip(`Radijus: do ${filterState.radius} km`, ()=>{ document.getElementById('radiusSelect').value=''; updateFilterState({radius:''}); runFiltering(); });
      if (filterState.duration){
        const mapDur={'3':'Do 3 h','5':'Do 5 h','8':'Do 8 h','10':'Do 10 h','>10':'Preko 10 h'};
        addChip(`Trajanje: ${mapDur[filterState.duration]||filterState.duration}`, ()=>{ document.getElementById('durationBucket').value=''; updateFilterState({duration:''}); runFiltering(); });
      }
      if (filterState.poi) addChip(`Odredište: ${filterState.poi}`, ()=>{ const i=document.getElementById('poiSearch'); if(i) i.value=''; updateFilterState({poi:''}); runFiltering(); });
      if (filterState.chipsSel?.length) addChip(`Težina: ${filterState.chipsSel.map(c=>DIFF_LABELS[c]||c).join(', ')}`, ()=>{
        document.querySelectorAll('.diff-chip:checked').forEach(i=>i.checked=false);
        updateFilterState({chipsSel:[]}); runFiltering();
      });
      const modeBits = [];
if (filterState.modeKm) modeBits.push('km');
if (filterState.modeElev) modeBits.push('nm/v');

if (modeBits.length) {
  addChip(`Kriteriji: ${modeBits.join(' + ')}`, () => {
    document.getElementById('modeKm').checked = true;
    document.getElementById('modeElev').checked = true;
    updateFilterState({ modeKm: true, modeElev: true });
    runFiltering();
  });
}
    }

    /* ---------------------------------------------------------
       #10.7 KARTICE
       --------------------------------------------------------- */
    function cardHTML(t){
  const diffKm = classifyByKm(t.distanceKm);
  const diffEl = classifyByElev(t.elevationM);

  const distChip = (distancesEnabled && typeof t._distKm === 'number')
    ? `<span class="dist-chip">${t._distKm.toFixed(1)} km od tebe</span>`
    : '';

  const areaFooter = (t.area || t.mountain)
    ? `<div class="card-footer">${t.area || t.mountain}</div>`
    : '';

  return `
    <article class="trail-card" data-id="${t.id}">
      <img src="${t.thumbnail}" alt="${t.name}" loading="lazy"/>
      <div class="pad">
        <div class="title-line">
          <h3>${t.name}</h3>
          ${distChip}
        </div>

        <div class="metric-row">
          <span class="metric-label">Duljina</span>
          <span class="metric-value">${t.distanceKm} km</span>
          <span class="diff-pill ${diffKm}" title="Ocjena težine po km">${DIFF_LABELS[diffKm]}</span>
        </div>

        <div class="metric-row">
          <span class="metric-label">nm/v</span>
          <span class="metric-value">${t.elevationM} m</span>
          <span class="diff-pill ${diffEl}" title="Ocjena težine po usponu">${DIFF_LABELS[diffEl]}</span>
        </div>

        <div class="metric-row">
          <span class="metric-label">Trajanje</span>
          <span class="metric-value">${t.durationH} h</span>
          <span></span>
        </div>

        <p class="card-desc">${t.description || ''}</p>
        ${areaFooter}
      </div>
    </article>
  `;
}
    
    function renderTrails(list){
      const host=document.getElementById('trail-list');
      host.innerHTML = list.map(cardHTML).join('') || `<p style="opacity:.8">Nema rezultata za odabrane filtere.</p>`;
    }

    /* ---------------------------------------------------------
       #10.8 FILTRIRANJE
       --------------------------------------------------------- */
        function matchesDifficulty(t, chipsSel, modeKm, modeElev){
  // ako nema odabranih “težina”, ne filtriraj po težini
  if (!chipsSel || !chipsSel.length) return true;

  const kmClass   = classifyByKm(t.distanceKm);
  const elevClass = classifyByElev(t.elevationM);

  const hitKm = modeKm   && chipsSel.includes(kmClass);
  const hitEl = modeElev && chipsSel.includes(elevClass);

  // ako su oba uključena → dovoljno je zadovoljiti barem jedan
  if (modeKm && modeElev) return (hitKm || hitEl);

  // samo jedan uključen → filtriraj po tom jednom
  if (modeKm)   return hitKm;
  if (modeElev) return hitEl;

  // ako su oba isključena → ne ograničavaj po težini
  return true;
}
    function matchesDuration(t,b){ if(!b) return true; const d=t.durationH||0; if(b==='>10') return d>10; return d <= parseFloat(b); }
    function matchesArea(t,a){ if(!a) return true; return t.area===a || t.mountain===a; }
    function matchesPOI(t,q){
      if(!q) return true;
      const s=norm(q);
      const hay=[t.name,t.area,t.mountain,t.routeType,...(t.tags||[]),...(t.destinations||[])].map(norm).join(' • ');
      return hay.includes(s);
    }
    async function matchesRadius(t, radius, mode){
      if (!radius) return true;
      const loc = await ensureGeolocationOnce();
      if (!loc) return true;
      const rKm = parseFloat(radius);
      if (mode==='air'){
        const d = haversineKm(loc.lat,loc.lon,t.startLat,t.startLon);
        return d <= rKm;
      }
      if (mode==='drive'){
        const km = await drivingDistanceKm(loc,{lat:t.startLat,lon:t.startLon});
        if (km==null){
          const dAir = haversineKm(loc.lat,loc.lon,t.startLat,t.startLon);
          return dAir <= rKm;
        }
        return km <= rKm;
      }
      const d = haversineKm(loc.lat,loc.lon,t.startLat,t.startLon);
      return d <= rKm;
    }
      async function filterList(){
  const { area, radius, duration, modeKm, modeElev, chipsSel, poi, distanceMode } = filterState;

  let base = TRAILS.filter(t =>
    matchesArea(t, area) &&
    matchesDuration(t, duration) &&
    matchesPOI(t, poi) &&
    matchesDifficulty(t, chipsSel, modeKm, modeElev)
  );
  
      if (radius){
        const results=[]; const loc=await ensureGeolocationOnce();
        for (const t of base){
          if (!loc){ results.push(t); continue; }
          const ok = await matchesRadius(t,radius,distanceMode);
          if (ok) results.push(t);
        }
        return results;
      }
      return base;
    }
    async function attachDistances(list){
      if (!distancesEnabled || !userLocation) return list;
      for (const t of list){
        if (typeof t.startLat==='number' && typeof t.startLon==='number'){
          t._distKm = haversineKm(userLocation.lat,userLocation.lon,t.startLat,t.startLon);
        } else t._distKm = undefined;
      }
      return list;
    }
    async function runFiltering(){
      let list = await filterList();
      if (userLocation) distancesEnabled = true;
      list = await attachDistances(list);
      if (filterState.radius && distancesEnabled){
        list.sort((a,b)=> (a._distKm ?? 1e9) - (b._distKm ?? 1e9));
      }
      renderTrails(list);
      renderActiveChips();
    }

    /* ---------------------------------------------------------
       #10.9 TABS + WIRING
       --------------------------------------------------------- */
    document.querySelectorAll('.filter-tab').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.filter-tab').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
        btn.classList.add('active');
        const id = btn.getAttribute('data-panel');
        const panel = document.getElementById(id);
        if (panel) panel.classList.add('active');

        if (id==='panel-radius') {
          ensureGeolocationOnce().then(loc => {
            if (loc){ distancesEnabled = true; runFiltering(); }
          });
        }
      });
    });

    document.getElementById('applyFilters').addEventListener('click', async ()=>{
      updateFilterState(stateFromControls());
      await runFiltering();
    });
    document.getElementById('quickReset').addEventListener('click', () => {
  ['areaSelect', 'radiusSelect', 'durationBucket'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });

  const dm = document.getElementById('distanceMode');
  if (dm) dm.value = 'air'; // resetiraj na zadanu opciju

  const modeKmEl   = document.getElementById('modeKm');
  const modeElevEl = document.getElementById('modeElev');
  if (modeKmEl)   modeKmEl.checked = true;
  if (modeElevEl) modeElevEl.checked = true;

  document.querySelectorAll('.diff-chip:checked').forEach(i => i.checked = false);

  const poi = document.getElementById('poiSearch');
  if (poi) poi.value = '';

  updateFilterState({
    area: '',
    radius: '',
    duration: '',
    poi: '',
    chipsSel: [],
    modeKm: true,
    modeElev: true,
    distanceMode: 'air'
  });

  runFiltering();
});

    document.addEventListener('change', async (e) => {
  const id = e.target.id;
  if (!id) return;

  if (id === 'distanceMode' && e.target.value === 'drive') {
    await ensureGeolocationOnce(true);
  }

  if (['areaSelect', 'radiusSelect', 'durationBucket', 'distanceMode', 'modeKm', 'modeElev'].includes(id)) {
    updateFilterState(stateFromControls());
    runFiltering();
  }
});
    document.addEventListener('input', (e)=>{
      if (e.target.id==='search'){ updateFilterState({ poi: e.target.value.trim() }); runFiltering(); }
      if (e.target.id==='poiSearch'){ updateFilterState({ poi: e.target.value.trim() }); runFiltering(); }
    });
    document.querySelectorAll('.diff-chip').forEach(cb=>{
      cb.addEventListener('change', ()=>{ updateFilterState(stateFromControls()); runFiltering(); });
    });

    /* ---------------------------------------------------------
       #10.10 INIT
       --------------------------------------------------------- */
    document.addEventListener('DOMContentLoaded', ()=>{
      renderTrails(TRAILS);
      renderActiveChips();
    });
  </script>
</body>
</html>
