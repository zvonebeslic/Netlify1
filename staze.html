<!DOCTYPE html>
<html lang="hr">
<head>
  <!-- =========================================================
       #01 META / ASSETI
       ========================================================= -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Mountain Adventures — Staze</title>

  <meta
    name="description"
    content="Istraži planinarske staze Balkana. Filtriraj po težini (km/nadmorska), planini/području, trajanju i udaljenosti od tvoje lokacije. GPX tragovi i sažeti opisi."
  />

  <link rel="icon" href="images/mountain-adventures.svg" type="image/svg+xml" />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="season.css" />

  <!-- =========================================================
       #02 STILOVI (čitko, red po red)
       ========================================================= -->
  <style>
    :root {
      --bg: #0b1110;
      --ink: #e8f1ed;
      --muted: #b7c7c0;
      --panel: #0f1a15;
      --panel-2: #0e1714;
      --line: rgba(255, 255, 255, 0.10);
      --brand: #2e7d5b;
      --brand-2: #3d9c73;
      --chip: #16231d;

      --diff-Easy-bg: #0f2c22;
      --diff-Easy-ink: #7ad8a1;
      --diff-Moderate-bg: #102638;
      --diff-Moderate-ink: #7fbaf2;
      --diff-Challenging-bg: #2a2914;
      --diff-Challenging-ink: #f3d36b;
      --diff-Hard-bg: #331f12;
      --diff-Hard-ink: #ffa066;
      --diff-Extreme-bg: #351616;
      --diff-Extreme-ink: #ff6b6b;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      overflow-x: hidden;
    }

    body {
      font-family: Montserrat, Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
      scroll-behavior: smooth;
    }

    a {
      color: #9fe1c5;
      text-decoration: none;
    }

    .container {
      max-width: 1150px;
      margin: 0 auto;
      padding: 0 14px;
    }

    /* =========================================================
       NAVBAR
       ========================================================= */
    .navbar {
      position: fixed;
      z-index: 1000;
      top: 0;
      right: 0;
      left: 0;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 15px;
      border-bottom: 1px solid var(--line);
      background: rgba(0, 0, 0, 0.55);
    }

    .navbar-left img {
      position: relative;
      height: 16px;
      width: 24px;
      cursor: pointer;
    }

    .navbar-left img:hover::after {
      position: absolute;
      top: 30px;
      left: 0;
      content: attr(data-tooltip);
      padding: 4px 8px;
      border-radius: 5px;
      background: #ffffff;
      color: #000;
      font-size: 12px;
      white-space: nowrap;
      box-shadow: 0 0 6px rgba(0, 0, 0, .2);
    }

.navbar-center {
  flex: 1;
  display: flex;
  justify-content: center;
  z-index: 1;
  transform: translateY(12px);
}

.search-container {
  width: 250px;
  position: relative;
  padding-top: 10px;
  z-index: 1;
}

.search-wrapper {
  position: relative;
  z-index: 2;
  width: 100%;
  height: 30px; /* ili 55px ako dodaješ prostor za sliku */
  background: #fff;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
  padding: 0 15px;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  overflow: visible;
  border-radius: 20px;
}

/* === UKRASNA PLANINA IZNAD TRAŽILICE === */
.search-top-decoration {
  position: absolute;
  top: -212.7px;
  left: 108px;
  width: 1600%;
  height: 30px;
  object-fit: cover;
  display: block;
  z-index: -10;
  transform: scale(19);
  transform-origin: top center;
  pointer-events: none;
}
      
/* === UNUTARNJI INPUT POLJE === */
.mountain-search {
  width: 100%;
  padding: 14px 40px 8px 12px;
  font-size: 14px;
  border: none;
  background: transparent;
  color: #333;
  outline: none;
}

/* === IKONA UNUTAR TRAŽILICE === */
.search-wrapper img {
  position: absolute;
  right: 12px;
  bottom: 8px;
  width: 19px;
  height: 19px;
  pointer-events: none;
}

    .navbar-right {
      display: flex;
      flex-direction: column;
      gap: 5px;
      padding: 8px;
      border: 1px solid rgba(255, 255, 255, .35);
      border-radius: 8px;
      background: rgba(255, 255, 255, .05);
      cursor: pointer;
    }

    .burger-line {
      width: 26px;
      height: 3px;
      border-radius: 2px;
      background: #fff;
    }

.menu-overlay {
  position: fixed;
  top: 70px;
  right: 0;
  width: 35vw;
  background-color: rgba(17, 17, 17, 0.95);
  color: white;
  padding: 20px;
  display: none;
  flex-direction: column;
  align-items: flex-start;
  z-index: 9999;
}

.menu-overlay.open {
  display: flex;
}

.menu-overlay a {
  margin: 10px 0;
  text-decoration: none;
  color: white;
  font-size: 1.1em;
  font-family: Arial, sans-serif;
}

    /* =========================================================
       HERO + NASLOV
       ========================================================= */
     .image-section {
  position: relative;
  height: 50vh;
  overflow: hidden;
}

/* overlay iznad videa, ali ne blokira klik */
.overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.55));
  z-index: 4;
  pointer-events: none;  /* <<< ključno */
}

/* svi videi složeni jedan preko drugog */
.image-section.hero-videos .hero-video {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  background: #000;            /* spriječi blink prije učitavanja */
  opacity: 0;
  transition: opacity .6s ease;
  pointer-events: none;
  z-index: 1;                  /* osnovni sloj */
}

/* aktivni je iznad osnovnog */
.image-section.hero-videos .hero-video.active {
  opacity: 1;
  z-index: 2;
}

/* sljedeći fade-in ide još iznad aktivnog */
.image-section.hero-videos .hero-video.next {
  opacity: 1;
  z-index: 3;
}

/* optional: pokaži da je klikabilno prebacivanje */
.image-section.hero-videos { cursor: pointer; }

/* accessibility: smanji animaciju ako je traženo u OS-u */
@media (prefers-reduced-motion: reduce) {
  .image-section.hero-videos .hero-video { transition: opacity .1s linear; }
}

    main .header {
      text-align: center;
      padding: 16px;
      border-bottom: 1px solid var(--line);
      border-radius: 16px;
      background: linear-gradient(180deg, #101b16, #0e1814);
    }

    main .header h1 {
      font-size: clamp(14px, 2.3vw, 19px);
      letter-spacing: .2px;
    }

    main .header p {
      margin-top: 8px;
      color: var(--muted);
      font-size: clamp(8px, 1.6vw, 10px);
    }

    /* =========================================================
       FILTERI — lijevo tab-gumbi (usko), desno panel (kompakt)
       ========================================================= */
    .filters-wrap {
      display: grid;
      grid-template-columns: 108px 1fr;
      gap: 10px;
      width: 100%;
      padding: 10px;
      border: 1px solid var(--line);
      border-radius: 14px;
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      box-shadow: 0 8px 24px rgba(0, 0, 0, .25);
      color: var(--ink);
    }

    .filters-left {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .filter-tab {
      width: 100%;
      text-align: left;
      padding: 6px 8px;
      border: 1px solid var(--line);
      border-radius: 9px;
      background: #121418;
      color: var(--ink);
      font-size: 12px;
      line-height: 1;
      letter-spacing: .2px;
      outline: none;
      transition: background .2s, border-color .2s, transform .04s;
    }

    .filter-tab:active {
      transform: scale(.985);
    }

    .filter-tab.active {
      background: linear-gradient(180deg, #152028, #12171d);
      border-color: #35404a;
    }

    .filters-actions {
      margin-top: 6px;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .btn-apply,
    .btn-reset {
      flex: 1 1 auto;
      padding: 6px 8px;
      border: 1px solid var(--line);
      border-radius: 9px;
      background: #121418;
      color: var(--ink);
      font-size: 12px;
      line-height: 1;
    }

    .btn-apply {
      background: linear-gradient(180deg, var(--brand), var(--brand-2));
      border-color: #1f815a;
      color: #fff;
      font-weight: 700;
    }

    .filters-right {
      padding: 10px;
      border: 1px solid var(--line);
      border-radius: 12px;
      min-height: 120px;
      background: #111418;
    }

    .panel {
      display: none;
    }

    .panel.active {
      display: block;
    }

    .panel-title {
      margin-bottom: 6px;
      color: var(--muted);
      font-size: 12px;
      font-weight: 700;
      letter-spacing: .2px;
    }

    .chips {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-start;
    }

    .chip {
      padding: 6px 8px;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: #20252c;
      color: var(--ink);
      font-size: 12px;
      line-height: 1;
    }

    .chip input {
      display: none;
    }

    .chip.active {
      background: #2b3440;
      border-color: #39424c;
    }

    .field {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .field label {
      min-width: 84px;
      color: var(--muted);
      font-size: 12px;
    }

    .select,
    .range,
    .button-slim {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid var(--line);
      border-radius: 9px;
      background: #0f1216;
      color: var(--ink);
      font-size: 11px;
      line-height: 1.1;
    }

    .hint {
      margin-top: 6px;
      font-size: 11px;
      color: var(--muted);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border: 1px solid #28303a;
      border-radius: 999px;
      background: #101419;
      color: #cde6d9;
      font-size: 11px;
      line-height: 1;
    }

    .active-chips {
  display: flex;
  flex-direction: column; 
  gap: 6px;                
}

      .active-chips .chip button {
  background: none;       
  border: none;           
  color: inherit;         
  font-size: 18px;        
  cursor: pointer;        
  padding: 0;             
  line-height: 1;
  margin-left: 15px;
}

.active-chips .chip button:hover {
  color: #ff6b6b;   
}
  
  /* === GEO TOAST =================================================== */
.geo-toast {
  position: fixed;
  left: 12px; right: 12px; bottom: 16px;
  z-index: 9999;
  transform: translateY(16px);
  opacity: 0;
  transition: opacity .18s ease, transform .18s ease;
}
.geo-hidden { pointer-events: none; }
.geo-toast:not(.geo-hidden) { opacity: 1; transform: translateY(0); }

.geo-toast-inner {
  background: linear-gradient(180deg, var(--panel, #0f1a15), var(--panel-2, #0e1714));
  color: var(--ink, #e8f1ed);
  border: 1px solid var(--line, rgba(255,255,255,.1));
  border-radius: 14px;
  padding: 14px;
  box-shadow: 0 10px 28px rgba(0,0,0,.35);
}
.geo-title { font-weight: 700; margin-bottom: 6px; font-size: 14px; }
.geo-msg { font-size: 13px; opacity: .9; }
.geo-actions { margin-top: 10px; display: flex; gap: 8px; }
.geo-btn {
  font-size: 13px; line-height: 1; padding: 8px 10px; border-radius: 10px;
  border: 1px solid var(--line, rgba(255,255,255,.1)); background: #2a3b35; color: #e8f1ed;
}
.geo-btn.ghost { background: transparent; }
      
    /* =========================================================
       LISTA STAZA — „prvi dan” kompakt
       ========================================================= */
    .trail-list {
      display: grid;
      grid-template-columns: 1fr !important;
      gap: 18px;
      justify-content: center;
      margin: 20px auto;
    }

      .trail-card {
  position: relative;
  width: 100%;
  height: 285px;            /* fiksna visina kartice */
  border: 1px solid var(--line);
  border-radius: 12px;
  background: #0f1a15;
  overflow: hidden;
  cursor: pointer;
  transition: transform .15s ease, box-shadow .15s ease;
}

.trail-card:active {
  transform: scale(.98);
  box-shadow: 0 4px 12px rgba(0,0,0,.3);
}

/* CTA u donjem desnom kutu */
.card-cta-bottom {
  position: absolute;
  right: 10px;
  bottom: 8px;
  padding: 6px 10px;
  border: 1px solid var(--line);
  border-radius: 999px;
  background: rgba(255,255,255,.06);
  font-size: 11px;
  color: #cfe9de;
  pointer-events: none; /* da ne “krade” tap od linka */
}

.trail-card img {
  position: absolute;
  top: 36px;
  right: 20px;
  width: 155px;
  height: 155px;      /* sad pokriva cijelu karticu */
  object-fit: cover;
  border-radius: 8px;
  z-index: 1;
}
    
    .trail-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, .25);
    }

    .trail-card .pad {
      position: relative;
      z-index: 2;
      height: 100%;
      padding: 10px;
    }

    /* === neutraliziraj link overlay za klikabilne kartice === */
a.trail-card,
a.trail-card:link,
a.trail-card:visited {
  color: inherit;
  text-decoration: none;
  background: none;
}

/* bez sivog/plavog pokrovnog sloja na hover/active */
a.trail-card:hover,
a.trail-card:active,
a.trail-card:focus {
  background: transparent !important;
}

/* mobiteli (Chrome/Safari): isključi tap highlight */
a.trail-card,
a.trail-card * {
  -webkit-tap-highlight-color: rgba(0,0,0,0);
}

/* po želji: pristojan fokus umjesto defaultnog */
a.trail-card:focus-visible {
  outline: 2px solid var(--brand-2);
  outline-offset: 2px;
}

    .title-line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .title-line h3 {
      margin: 0;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: .2px;
    }

    .dist-chip {
      padding: 3px 7px;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: #13231c;
      color: #cfe9de;
      font-size: 11px;
      white-space: nowrap;
      line-height: 1;
    }

      /* === METRIKE U KARTICI STAZE === */
/* Labela u prvom redu preko cijele širine,
   ispod red: vrijednost (lijevo) | badge (desno) */
.metric-row {
  display: grid;
  grid-template-columns: auto auto 1fr;   /* value | pill */
  grid-template-rows: auto auto;     /* label | (value+pill) */
  grid-template-areas:
    "label label"
    "value pill";
  row-gap: 2px;
  column-gap: 8px;
  padding: 6px 0;
  border-top: 1px dashed rgba(255, 255, 255, .08);
  justify-items: start;  /* NE rasteži djecu po širini ćelije */
  align-items: center;   /* poravnaj po vertikali */
}

.metric-row:first-of-type {
  border-top: 0;
}

/* labela (sitnija, sivkasta) */
.metric-label {
  grid-area: label;
  font-size: 10px;
  font-weight: 600;
  opacity: .75;
}

/* vrijednost (istaknuta) */
.metric-value {
  grid-area: value;
  white-space: nowrap;
  font-size: 10px;
  font-weight: 700;
  color: #fff;
  opacity: .95;
  align-self: center; /* vertikalno centriraj u drugom redu */
}

/* badge (diff-pill) desno u drugom redu */
.metric-row .diff-pill {
  grid-area: pill;
  justify-self: start;  
  margin: 0;           /* bez dodatnih rubova, grid rješava razmak */
}

/* ako neki red nema badge (prazan span), sakrij ga */
.metric-row > span:empty {
  display: none;
}

/* === OPĆI IZGLED diff-pill-a (zadržavaš svoje boje po težini) === */
.diff-pill {
  padding: 3px 7px;
  border: 1px solid var(--line);
  border-radius: 999px;
  font-size: 10px;
  line-height: 1;
  white-space: nowrap;
  background: rgba(255, 255, 255, .06);  /* suptilna pozadina */
  color: #fff;                            /* tekst bijel */
}

/* ako već imaš klase .diff-pill.Easy / .Hard / .Extreme...
   ostavi ih – ove gore su samo “default” stilovi */

    .diff-pill.Easy {
      background: var(--diff-Easy-bg);
      color: var(--diff-Easy-ink);
    }

    .diff-pill.Moderate {
      background: var(--diff-Moderate-bg);
      color: var(--diff-Moderate-ink);
    }

    .diff-pill.Challenging {
      background: var(--diff-Challenging-bg);
      color: var(--diff-Challenging-ink);
    }

    .diff-pill.Hard {
      background: var(--diff-Hard-bg);
      color: var(--diff-Hard-ink);
    }

    .diff-pill.Extreme {
      background: var(--diff-Extreme-bg);
      color: var(--diff-Extreme-ink);
    }

    .card-desc {
      display: block !important;
      margin-top: 8px;
      color: #fff;
      line-height: 1.4;
      font-size: 10px;
      overflow-wrap: anywhere;
      word-break: break-word;
      white-space: normal !important;
      max-width: 100%;
    }

    .card-footer {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px dashed rgba(255, 255, 255, .08);
      color: var(--muted);
      font-size: 10px;
    }

.metric-label,
.metric-value,
.dist-chip,
.card-footer {
  width: max-content;
  display: inline-block;
  padding: 3px 7px;
  border: 1px solid var(--line);
  border-radius: 999px;
  background: rgba(15, 26, 21, 0.6);
  font-size: 10px;
  line-height: 1.2;
  white-space: nowrap;
}

 /* ROUTE badge uz trajanje (desno) */
.metric-row.route-row .pill-right {
  grid-area: pill;
  justify-self: end;   /* desni rub reda */
}
.route-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 22px;
  height: 22px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.06);
  vertical-align: middle;
}
.route-badge svg { width: 14px; height: 14px; display: block; }   

    /* =========================================================
       FOOTER / BACK TO TOP
       ========================================================= */
      #backToTop {
  position: fixed;
  bottom: 22px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 9999;
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(12px);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.3);
  outline: none;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  cursor: pointer;
  display: none;
  align-items: center;
  justify-content: center;
  transition: background 0.3s ease, transform 0.3s ease;
}

#backToTop:hover {
  background-color: rgba(255, 255, 255, 0.3);
  transform: translateX(-50%) scale(1.1);
}

#backToTop svg {
  width: 24px;
  height: 24px;
}

  footer {
  background: #111;
  color: #ccc;
  font-family: Arial, sans-serif !important;
  text-align: center;
  padding: 20px 10px;
  font-size: 14px;
  position: relative;
  margin-top: 60px;
}

.footer-icons {
  margin: 10px 0;
}

.footer-icons svg {
  width: 32px;
  height: 32px;
  margin: 0 10px;
  vertical-align: middle;
  opacity: 0.8;
  transition: opacity 0.3s, transform 0.3s;
}

.footer-icons svg:hover {
  opacity: 1;
  transform: scale(1.1);
}
    
  </style>
</head>

<body>

<!-- === NAVIGACIJA (gore) === -->
  <div class="navbar">
    <div class="navbar-left">
      <img src="images/flag-uk.svg" alt="promjena jezika na engleski" id="language-toggle" data-tooltip="Promijeni jezik">
    </div>
    <div class="navbar-center">
      <div class="search-container">
        <div class="search-wrapper">
          <img src="images/planine-za-trazilicu.png" alt="planinski-vrhovi" class="search-top-decoration" />
          <input type="text" class="mountain-search" id="search" placeholder="Pretraži...">
          <img src="images/search.svg" alt="ikona za tražilicu">
        </div>
      </div>
    </div>
    <div class="navbar-right" id="menu-toggle">
      <div class="burger-line"></div>
      <div class="burger-line"></div>
      <div class="burger-line"></div>
    </div>
  </div>

  <!-- === HAMBURGER MENI === -->
  <div class="menu-overlay" id="menu">
    <a href="index.html" data-hr="Naslovna" data-en="Home">Naslovna</a>
    <a href="staze.html" data-hr="Staze" data-en="Trails">Staze</a>
    <a href="avantura.html" data-hr="Avantura" data-en="Adventure">Avantura</a>
    <a href="webshop.html" data-hr="Web shop" data-en="Web Shop">Web shop</a>
    <a href="planinarskevijesti.html" data-hr="Blog" data-en="Blog">Blog</a>
    <a href="digitalniruksak.html" data-hr="Digitalni ruksak" data-en="Digital backpack">Digitalni ruksak</a>
    <a href="kontakt.html" data-hr="Kontakt" data-en="Contact">Kontakt</a>
  </div>

  <!-- === SEASON TOGGLE IKONE === -->
<div id="season-toggle-wrapper">
  <img src="images/seasonchange.svg" id="season-toggle" alt="odabir godišnjeg doba" />
  <div id="season-strike" class="hidden"></div> <!-- KOSA CRTA -->
  <div id="season-icons">
    <div class="season-icon" data-season="winter">❄️</div>
    <div class="season-icon" data-season="spring">🌸</div>
    <div class="season-icon" data-season="summer">☀️</div>
    <div class="season-icon" data-season="autumn">🍂</div>
  </div>
 </div>
  
  <!-- HERO sekcija s 5 videa -->
  <section class="image-section hero-videos">
    <!-- Video 1 -->
    <video class="hero-video active" autoplay muted playsinline preload="metadata">
         <source src="videos/Planinarske-staze1.mp4" type="video/mp4">
    </video>

    <!-- Video 2 -->
    <video class="hero-video" muted playsinline preload="metadata">
         <source src="videos/Planinarske-staze2.mp4" type="video/mp4">
    </video>

    <!-- Video 3 -->
    <video class="hero-video" muted playsinline preload="metadata">
         <source src="videos/Planinarske-staze3.mp4" type="video/mp4">
    </video>

    <!-- Video 4 -->
    <video class="hero-video" muted playsinline preload="metadata">
        <source src="videos/Planinarske-staze4.mp4" type="video/mp4">
    </video>

    <!-- Video 5 -->
    <video class="hero-video" muted playsinline preload="metadata">
        <source src="videos/Planinarske-staze5.mp4" type="video/mp4">
    </video>

    <!-- Tamni overlay preko videa -->
    <div class="overlay"></div>
  </section>

  <main class="container">
    <section class="header">
      <h1>Istražite planinarske staze</h1>
      <p>Pronađite svoju turu prema težini (km/mnv), planini/području, vremenu hodanja ili udaljenosti od vaše lokacije.</p>
      <p>Kombinirajte više različitih filtera kako bi pronašli idealnu stazu za sebe. Gumb "primijeni" koristite u slučaju da vam se staze automatski ne budu izbacivale pri odabiru filtera, a gumb "osvježi" koristite kada želite ukloniti odabrane filtere.</p>
    </section>

    <!-- FILTERI (Lijevo: mali gumbi; Desno: mali paneli) -->
    <section class="filters-wrap" style="margin-top:14px;">
      <!-- lijevo -->
      <div class="filters-left">
        <button class="filter-tab active" data-panel="panel-diff">Težina</button>
        <button class="filter-tab" data-panel="panel-radius">Udaljenost</button>
        <button class="filter-tab" data-panel="panel-area">Područje</button>
        <button class="filter-tab" data-panel="panel-duration">Trajanje</button>
        <button class="filter-tab" data-panel="panel-poi">Tražilica</button>

        <div class="filters-actions">
          <button id="applyFilters" class="btn-apply" type="button">Primijeni</button>
          <button id="quickReset" class="btn-reset" type="button">Osvježi</button>
        </div>
      </div>

      <!-- desno -->
      <div class="filters-right">
        <!-- TEŽINA -->
        <div id="panel-diff" class="panel active">
  <div class="panel-title">Ocijeni po kilometraži i/ili nadmorskoj visini</div>

    <div class="field">
  <label>Uključi</label>
  <div style="display:flex; gap:8px; flex-wrap:wrap;">
    <!-- mora imati ID jer ih čita JS -->
    <label class="badge"><input id="modeKm" type="checkbox" checked /> km</label>
    <label class="badge"><input id="modeElev" type="checkbox" checked /> m/nv</label>
  </div>
  </div>
          
   <div class="field">
  <label for="difficultySelect">Težina</label>
  <select id="difficultySelect" class="select">
    <option value="">Bez ograničenja</option>
    <option value="Easy">Do 4km i 100m/nv</option>
    <option value="Moderate">4-8km i 100-300m/nv</option>
    <option value="Challenging">8-14km i 300-800m/nv</option>
    <option value="Hard">14-18km i 800-1300m/nv</option>
    <option value="Extreme">Iznad 18km i 1300m/nv </option>
  </select>
</div>

  <p class="hint">Savjet: uključi “km” i/ili “m/nv”. Ako su oba filtera uključena, prikazuju se staze koje zadovolje barem jedan od njih.</p>
</div>
    
        <!-- UDALJENOST -->
        <div id="panel-radius" class="panel">
          <div class="panel-title">Udaljenost od vaše lokacije</div>
          <div class="field">
            <label for="radiusSelect">Radijus</label>
            <select id="radiusSelect" class="select">
              <option value="">Bez ograničenja</option>
              <option value="5">Do 5 km</option>
              <option value="10">Do 10 km</option>
              <option value="50">Do 50 km</option>
              <option value="100">Do 100 km</option>
              <option value="200">Do 200 km</option>
            </select>
          </div>
          <div class="field">
            <label for="distanceMode">Mjerenje</label>
            <select id="distanceMode" class="select">
              <option value="air" selected>Zračna linija (preporučeno)</option>
              <option value="drive">Vožnja autom (beta)</option>
            </select>
          </div>
          <p class="hint">Dopusti lokaciju za automatski prikaz “XX km od vas” na svakoj kartici.</p>
        </div>

        <!-- PODRUČJE -->
        <div id="panel-area" class="panel">
          <div class="panel-title">Planina / područje</div>
          <div class="field">
            <label for="areaSelect">Lokacija</label>
            <select id="areaSelect" class="select">
              <option value="">Sve lokacije</option>
            </select>
          </div>
        </div>

        <!-- TRAJANJE -->
        <div id="panel-duration" class="panel">
          <div class="panel-title">Vrijeme hodanja</div>
          <div class="field">
            <label for="durationBucket">Trajanje</label>
            <select id="durationBucket" class="select">
              <option value="">Bilo koje</option>
              <option value="3">Do 3 h</option>
              <option value="5">Do 5 h</option>
              <option value="8">Do 8 h</option>
              <option value="10">Do 10 h</option>
              <option value=">10">Preko 10 h</option>
            </select>
          </div>
        </div>

        <!-- TRAŽILICA (POI) -->
        <div id="panel-poi" class="panel">
          <div class="panel-title">Tražilica odredišta (vrh/mjesto)</div>
          <input id="poiSearch" class="select" type="search" placeholder="npr. Hajdučka Vrata, Kredarica" />
        </div>
      </div>
    </section>

    <!-- AKTIVNI ČIPOVI -->
    <section id="activeChips" class="active-chips" style="margin-top:12px;"></section>
    
    <!-- GEO TOAST (podsjetnik za GPS/dozvole) -->
<div id="geo-toast" class="geo-toast geo-hidden" role="alert" aria-live="polite">
  <div class="geo-toast-inner">
    <div class="geo-title" id="geo-title">Treba pristup lokaciji</div>
    <div class="geo-msg" id="geo-msg">
      Uključi GPS (Lokacija) i dopusti pristup kako bismo prikazali staze u blizini.
    </div>
    <div class="geo-actions">
      <button id="geo-try-again" class="geo-btn">Pokušaj ponovno</button>
      <button id="geo-close" class="geo-btn ghost">Zatvori</button>
    </div>
  </div>
</div>

    
    <!-- LISTA STAZA -->
    <section id="trail-list" class="trail-list"></section>
  </main>

  <!-- FOOTER + BACK TO TOP -->
  <button id="backToTop" title="Na vrh" aria-label="Gumb na vrh">
    <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <polyline points="18 15 12 9 6 15"></polyline>
    </svg>
  </button>

  <footer id="footer">
    <div class="footer-icons">
      <a href="https://instagram.com/mountainadventures__" target="_blank" aria-label="Instagram">
        <svg viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
          <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
          <line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line>
        </svg>
      </a>
      <a href="mailto:mountainadventures1717@gmail.com" aria-label="Email">
        <svg viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
          <polyline points="22,6 12,13 2,6"></polyline>
        </svg>
      </a>
    </div>
    © Mountain Adventures. All rights reserved.
  </footer>

         
       
  <script src="season.js"></script>
  <script src="popis-staza.js"></script>

<script>
  /* ---------------------------------------------------------
     #10.1 NAV / JEZIK / MENI / BACK-TO-TOP
     --------------------------------------------------------- */
  const langToggle = document.getElementById('language-toggle');
  const searchInput = document.getElementById('search');
  const menuToggle = document.getElementById('menu-toggle');
  const menu = document.getElementById('menu');
  const backToTopBtn = document.getElementById('backToTop');
  const footer = document.getElementById('footer');

  function getInitialLang() {
    const urlLang = new URLSearchParams(location.search).get('lang');
    if (['hr', 'en'].includes(urlLang)) return urlLang;
    try { const s = localStorage.getItem('preferredLang'); if (['hr','en'].includes(s)) return s; } catch(e){}
    return 'hr';
  }

  function applyLanguage(lang) {
    try { localStorage.setItem('preferredLang', lang); } catch(e){}
    const u = new URL(location.href); u.searchParams.set('lang', lang); history.replaceState({}, '', u.toString());
    document.documentElement.lang = lang;

    if (langToggle) {
      langToggle.src = lang === 'hr' ? 'images/flag-uk.svg' : 'images/flag-hr.svg';
      langToggle.alt = lang === 'hr' ? 'Promijeni na engleski' : 'Switch to Croatian';
      langToggle.setAttribute('data-tooltip', lang === 'hr' ? 'Promijeni jezik' : 'Change language');
    }
    if (searchInput) searchInput.placeholder = lang === 'hr' ? 'Pretraži...' : 'Search...';

    document.querySelectorAll('[data-hr]').forEach(el => {
      const v = el.getAttribute('data-' + lang);
      if (v == null) return;
      if (v.includes('<')) el.innerHTML = v; else el.textContent = v;
    });
    document.querySelectorAll('.menu-overlay a').forEach(a => {
      const v = a.getAttribute('data-' + lang); if (v != null) a.textContent = v;
    });
  }

  let currentLang = getInitialLang();
  applyLanguage(currentLang);
  if (langToggle) langToggle.addEventListener('click', () => { currentLang = currentLang === 'hr' ? 'en' : 'hr'; applyLanguage(currentLang); });

  menuToggle.addEventListener('click', () => { menu.classList.toggle('open'); });
  window.addEventListener('click', (e) => { if (!menu.contains(e.target) && !menuToggle.contains(e.target) && e.target.id !== 'language-toggle') menu.classList.remove('open'); });
  document.querySelectorAll('.menu-overlay a').forEach(l => l.addEventListener('click', () => menu.classList.remove('open')));

  window.addEventListener('scroll', () => {
    const y = window.scrollY; const footerTop = footer.getBoundingClientRect().top + window.scrollY; const h = window.innerHeight;
    backToTopBtn.style.display = y > 300 ? 'flex' : 'none';
    backToTopBtn.style.bottom = (y + h > footerTop) ? ((y + h - footerTop) + 60) + 'px' : '30px';
  });
  backToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

  document.addEventListener('DOMContentLoaded', () => {
    const s = localStorage.getItem('activeSeason');
    if (s) {
      setTimeout(() => {
        if (s === 'winter') startWinterEffect(true);
        else if (s === 'summer') startSummerEffect(true);
        else if (s === 'spring') startSpringEffect(true);
        else if (s === 'autumn') startAutumnEffect(true);
      }, 10000);
    }
    fetch('season.html').then(r => r.text()).then(html => {
      const ph = document.getElementById('season-placeholder'); if (ph) ph.innerHTML = html;
      if (typeof initializeSeasonToggle === 'function') initializeSeasonToggle();
    }).catch(() => {});
  });

  /* ---------------------------------------------------------
     #10.2 TEŽINSKE KATEGORIJE
     --------------------------------------------------------- */
  const DIFF_LABELS = {
    'Easy': 'Lako',
    'Moderate': 'Umjereno',
    'Challenging': 'Zahtjevno',
    'Hard': 'Jako teško',
    'Extreme': 'Ekstremno'
  };
  function classifyByKm(km){ if (km <= 4) return 'Easy'; if (km <= 8) return 'Moderate'; if (km <= 14) return 'Challenging'; if (km <= 18) return 'Hard'; return 'Extreme'; }
  function classifyByElev(m){ if (m <= 100) return 'Easy'; if (m <= 300) return 'Moderate'; if (m <= 800) return 'Challenging'; if (m <= 1300) return 'Hard'; return 'Extreme'; }
  const norm = (s)=> (s||'').toString().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');

  /* =========================================================
     #10.3 GEOLOKACIJA + UDALJENOSTI
     ========================================================= */

  // --- ELEMENTI GEO TOASTA (već postoje u HTML-u) ---
  const geoToastEl = document.getElementById('geo-toast');
  const geoTitleEl = document.getElementById('geo-title');
  const geoMsgEl   = document.getElementById('geo-msg');
  const geoTryBtn  = document.getElementById('geo-try-again');
  const geoCloseBtn= document.getElementById('geo-close');

  let __geoLastRetry = null;
  function showGeoToast(title, msg, onRetry){
    if (geoToastEl && geoTitleEl && geoMsgEl) {
      geoTitleEl.textContent = title;
      geoMsgEl.textContent = msg;
      __geoLastRetry = typeof onRetry === 'function' ? onRetry : null;
      geoToastEl.classList.remove('geo-hidden');
    } else {
      alert(title + '\n\n' + msg);
      if (typeof onRetry === 'function') onRetry();
    }
  }
  function hideGeoToast(){ if (geoToastEl) geoToastEl.classList.add('geo-hidden'); }
  geoTryBtn?.addEventListener('click', ()=>{ hideGeoToast(); if (__geoLastRetry) __geoLastRetry(); });
  geoCloseBtn?.addEventListener('click', hideGeoToast);

  // --- Permissions helper + mapiranje geolokacijskih grešaka ---
  async function getGeoPermissionState() {
    try {
      if (!('permissions' in navigator) || !navigator.permissions?.query) return null;
      const res = await navigator.permissions.query({ name: 'geolocation' });
      return res?.state; // 'granted' | 'prompt' | 'denied'
    } catch { return null; }
  }

  async function mapGeoError(error) {
    const permState = await getGeoPermissionState();
    // 1=PERMISSION_DENIED, 2=POSITION_UNAVAILABLE, 3=TIMEOUT
    if (error.code === 1) {
      return (permState === 'denied')
        ? { type: 'denied', raw: error }
        : { type: 'unavailable', raw: error }; // često: OS lokacija ugašena
    }
    if (error.code === 2) return { type: 'unavailable', raw: error };
    if (error.code === 3) return { type: 'timeout', raw: error };
    return { type: 'unknown', raw: error };
  }

  // --- Jedinstveni “help” toast za sve slučajeve ---
  function showUnifiedGeoHelp(retryCb) {
    showGeoToast(
  'Lokacija nije dostupna',
  'GPS/lokacija na vašem uređaju je isključena ili nedostupna.\n\n' +
  'Da bi pronašli staze pomoću filtera za udaljenost, uključite vašu lokaciju i zatim kliknite na "Pokušaj ponovno".',
      retryCb
    );
  }

  // --- Globalno stanje geolokacije ---
  let userLocation = null;        // {lat, lon, accuracy?}
  let distancesEnabled = false;

  // --- Jednokratni pokušaj dohvaćanja lokacije (robusno mapiranje) ---
  function requestLocationOnce(options = { enableHighAccuracy:true, timeout:12000, maximumAge:120000 }) {
    return new Promise((resolve, reject) => {
      if (!('geolocation' in navigator)) {
        reject({ type:'unsupported' });
        return;
      }
      navigator.geolocation.getCurrentPosition(
        pos => resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude, accuracy: pos.coords.accuracy }),
        async err => reject(await mapGeoError(err)),
        options
      );
    });
  }

  // --- Ensure wrapper: pokazuje jedinstveni vodič + retry ---
  function ensureLocationThen(cb){
    if (userLocation) { cb(userLocation); return; }

    requestLocationOnce().then(loc=>{
      userLocation = loc;
      distancesEnabled = true;
      cb(userLocation);
    }).catch(e=>{
      if (e?.type === 'unsupported') {
        showGeoToast('Geolokacija nije podržana', 'Ovaj preglednik ne podržava geolokaciju. Otvori stranicu u novijem pregledniku.', null);
        return;
      }
      showUnifiedGeoHelp(()=> ensureLocationThen(cb));
    });
  }

  // --- Haversine (zračna linija) ---
  function haversineKm(lat1,lon1,lat2,lon2){
    const R=6371, toRad=d=>d*Math.PI/180;
    const dLat=toRad(lat2-lat1), dLon=toRad(lon2-lon1);
    const a=Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
    return 2*R*Math.asin(Math.sqrt(a));
  }

  // --- Driving distance (OSRM) + cache + timeout ---
  const driveCache=new Map();
  const withTimeout=(p,ms=7000)=>Promise.race([p,new Promise((_,rej)=>setTimeout(()=>rej(new Error('timeout')),ms))]);
  async function drivingDistanceKm(origin,dest){
    if (!origin||!dest) return null;
    const key=`${origin.lat},${origin.lon}->${dest.lat},${dest.lon}`;
    if (driveCache.has(key)) return driveCache.get(key);

    const url=`https://router.project-osrm.org/route/v1/driving/${origin.lon},${origin.lat};${dest.lon},${dest.lat}?overview=false`;
    try{
      const resp=await withTimeout(fetch(url),7000);
      if(!resp.ok) throw new Error('bad status');
      const data=await resp.json();
      const m=data?.routes?.[0]?.distance;
      const km=(typeof m==='number')? m/1000 : null;
      if(km!=null) driveCache.set(key,km);
      return km;
    }catch(_){ return null; }
  }

  /* =========================================================
     #10.4 PODRUČJA (AREAS)
     ========================================================= */

  const AREAS = ["Park prirode Blidinje","Velebit","Begunjščica","Klekovača","Sljeme","Medvednica","Dinara",
                 "Oštrovača","Šator","Kozara","Ivanščica","Kamešnica","Cincar","Vranica","Matinski Vis","Zavelim",
                 "Golija","Stožer","Ljubuša","Tušnica","Svilaja","Biokovo","Mosor","Raduša","Vran","Čvrsnica","Čabulja",
                 "Prenj","Crvanj","Matokit","Velež","Visočica","Bjelašnica","Treskavica","Zelengora","Volujak","Maglić",
                 "Lelija","Durmitor","Komovi","Prokletije","Šar planina","Otok Pag","Poluotok Pelješac","Šipovo",
                 "Otok Hvar","Otok Brač","Kanjon Badnjevice","Oštrc","Učka","Risnjak","Snježnik","Papuk","Psunj","Kalnik",
                 "Ugljan","Krk","Cres","Mljet","Nanos","Snežnik (SLO)","Stol (Karavanke)","Krn","Grintovec","Velika planina",
                 "Vitosha","Rila","Pirin","Stara planina (BG)","Rhodope","Osogovo","Belasica","Strandzha","Kopaonik",
                 "Stara planina (RS)","Rtanj","Suva planina","Zlatibor","Tara","Fruška gora","Rudnik","Jastrebac","Maljen",
                 "Homolje","Orjen","Lovćen","Rumija"];

  (function fillAreas(){
    const sel = document.getElementById('areaSelect');
    AREAS.forEach(a => {
      const o = document.createElement('option');
      o.value = a;
      o.textContent = a;
      sel.appendChild(o);
    });
  })();

  /* =========================================================
     #10.5 STATE (distanceMode default = 'air')
     ========================================================= */

  const filterState = {
    area: '',
    radius: '',
    duration: '',
    modeKm: true,
    modeElev: true,
    difficulty: '',
    poi: '',
    distanceMode: 'air' // 'air' | 'drive'
  };
  function stateFromControls(){
    return {
      area: document.getElementById('areaSelect')?.value || '',
      radius: document.getElementById('radiusSelect')?.value || '',
      duration: document.getElementById('durationBucket')?.value || '',
      poi: document.getElementById('poiSearch')?.value?.trim() || '',
      modeKm: document.getElementById('modeKm')?.checked ?? true,
      modeElev: document.getElementById('modeElev')?.checked ?? true,
      difficulty: document.getElementById('difficultySelect')?.value || '',
      distanceMode: document.getElementById('distanceMode')?.value || 'air'
    };
  }
  function updateFilterState(ns){ Object.assign(filterState, ns); }

  /* === STATE za udaljenost / geolokaciju (praćenje) === */
const distanceTracking = {
  active: false,
  watchId: null,
  lastPos: null
};

function upsertActiveChip(id, label, onRemove) {
  const host = document.getElementById('activeChips');
  let chip = host.querySelector(`[data-chip="${id}"]`);
  if (!chip) {
    chip = document.createElement('span');
    chip.className = 'chip';
    chip.dataset.chip = id;
    chip.innerHTML = `${label} <button type="button" aria-label="Ukloni">×</button>`;
    chip.querySelector('button').addEventListener('click', () => {
      try { onRemove?.(); } finally { chip.remove(); }
      renderActiveChips();
      runFiltering();
    });
    host.prepend(chip); // na početak liste čipova
  } else {
    const btn = chip.querySelector('button');
    chip.firstChild.nodeValue = label + ' ';
    btn.onclick = () => { onRemove?.(); chip.remove(); renderActiveChips(); runFiltering(); };
  }
}

function removeActiveChip(id) {
  const host = document.getElementById('activeChips');
  const chip = host.querySelector(`[data-chip="${id}"]`);
  if (chip) chip.remove();
}

  function startDistanceTracking() {
  if (distanceTracking.active) {
    // već aktivno: samo osiguraj lokaciju i refresh
    ensureLocationThen(() => { distancesEnabled = true; runFiltering(); });
    upsertActiveChip('distance', 'Udaljenost: aktivno', stopDistanceTracking);
    return;
  }

  // 1) Označi kao aktivno ODMAH i prikaži čip
  distanceTracking.active = true;
  upsertActiveChip('distance', 'Izračunavanje udaljenosti od vas', stopDistanceTracking);

  // 2) Osiguraj lokaciju + pokreni watch
  ensureLocationThen(() => {
    try {
      distanceTracking.watchId = navigator.geolocation.watchPosition(
        pos => {
          distanceTracking.lastPos = pos.coords;
          userLocation = { lat: pos.coords.latitude, lon: pos.coords.longitude, accuracy: pos.coords.accuracy };
          distancesEnabled = true;
          upsertActiveChip('distance', 'Udaljenost: aktivno', stopDistanceTracking);
          runFiltering();
        },
        async err => {
          console.warn('watchPosition error:', err);
          const mapped = await mapGeoError(err);
          showUnifiedGeoHelp(() => startDistanceTracking());
          stopDistanceTracking({ silent: true });
        },
        { enableHighAccuracy: true, maximumAge: 10000, timeout: 15000 }
      );
    } catch {
      runFiltering();
    }
  });
}

function stopDistanceTracking(opts = { silent: false }) {
  if (distanceTracking.watchId != null) {
    try { navigator.geolocation.clearWatch(distanceTracking.watchId); } catch {}
  }
  distanceTracking.watchId = null;
  distanceTracking.active = false;
  distanceTracking.lastPos = null;

  // Poništi UI odabire vezane za udaljenost
  const radiusSel = document.getElementById('radiusSelect');
  if (radiusSel) radiusSel.value = '';

  // Vrati način mjerenja na zračnu liniju
  const dm = document.getElementById('distanceMode');
  if (dm) dm.value = 'air';

  // Makni čip
  removeActiveChip('distance');

  // Ako želiš potpuno prestati koristiti postojeću lokaciju:
  userLocation = null;
  distancesEnabled = false;

  if (!opts.silent) runFiltering();
}

  /* =========================================================
     #10.6 AKTIVNI ČIPOVI
     ========================================================= */
  function renderActiveChips(){
    const host = document.getElementById('activeChips'); host.innerHTML='';
    function addChip(label, onRemove){
      const chip=document.createElement('span'); chip.className='chip';
      chip.innerHTML = `${label} <button type="button" aria-label="Ukloni">×</button>`;
      chip.querySelector('button').addEventListener('click', onRemove);
      host.appendChild(chip);
    }
    if (filterState.area) addChip(`Lokacija: ${filterState.area}`, ()=>{ document.getElementById('areaSelect').value=''; updateFilterState({area:''}); runFiltering(); });
      
    if (filterState.duration){
      const mapDur={'3':'Do 3 h','5':'Do 5 h','8':'Do 8 h','10':'Do 10 h','>10':'Preko 10 h'};
      addChip(`Trajanje: ${mapDur[filterState.duration]||filterState.duration}`, ()=>{ document.getElementById('durationBucket').value=''; updateFilterState({duration:''}); runFiltering(); });
    }
    if (filterState.poi) addChip(`Odredište: ${filterState.poi}`, ()=>{ const i=document.getElementById('poiSearch'); if(i) i.value=''; updateFilterState({poi:''}); runFiltering(); });
       if (filterState.difficulty) {
  const sel = document.getElementById('difficultySelect');
  const selectedOpt = sel ? sel.querySelector(`option[value="${filterState.difficulty}"]`) : null;
  const label = selectedOpt ? selectedOpt.textContent : filterState.difficulty;

  addChip(`Težina: ${label}`, () => {
    if (sel) sel.value = '';
    updateFilterState({ difficulty: '' });
    runFiltering();
  });
}
    const modeBits = [];
    if (filterState.modeKm) modeBits.push('km');
    if (filterState.modeElev) modeBits.push('m/nv');
    if (modeBits.length) {
      addChip(`Kriteriji: ${modeBits.join(' + ')}`, () => {
        document.getElementById('modeKm').checked = true;
        document.getElementById('modeElev').checked = true;
        updateFilterState({ modeKm: true, modeElev: true });
        runFiltering();
      });
    }
  // Udaljenost čip (ako je aktivan radius ili praćenje)
if (filterState.radius || distanceTracking.active) {
  const modeLabel = (filterState.distanceMode === 'drive') ? 'vožnje' : 'zračne linije';
  const base = filterState.radius ? `Radijus: do ${filterState.radius} km` : 'Udaljenost';
  const text = distanceTracking.active ? `${base} • računanje ${modeLabel}` : base;
  upsertActiveChip('distance', text, stopDistanceTracking);
}
  }

/* ---------------------------------------------------------
   #10.2b FORMATIRANJE VREMENA (sati:minute)
   --------------------------------------------------------- */
function formatHMM(hoursDecimal) {
  const val = Number(hoursDecimal);
  if (!isFinite(val)) return '-';
  let h = Math.floor(val);
  let m = Math.round((val - h) * 60);
  if (m === 60) { h += 1; m = 0; }
  return `${h}:${m.toString().padStart(2, '0')} h`;
  // Ako želiš točno "4.30" umjesto "4:30 h", koristi:
  // return `${h}.${m.toString().padStart(2, '0')}`;
}

  /* === ROUTE TYPE BADGE (↺ kružna / ⇄ povratna) — HR only ================ */
function routeBadgeHTML(routeType) {
  const rt = (routeType || '').toLowerCase();
  const isLoop    = /kružna|kruzna|loop|circular/.test(rt);
  const isOutBack = /povratna|isti put|out.*back/.test(rt);

  const labelHR = isLoop ? 'Kružna tura' : (isOutBack ? 'Povratna (isti put)' : 'Ruta');

  const svgLoop = `
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
            d="M7 7h7.5a4.5 4.5 0 0 1 0 9H7"/>
      <path fill="currentColor" d="M7 3.8l3.2 3.2L7 10.2 3.8 7z"/>
    </svg>`;

  const svgOutBack = `
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path fill="currentColor" d="M5 7h9l-2.8-2.8 1.4-1.2L18 8.4 12.6 13.8l-1.4-1.2L14 10H5z"></path>
      <path fill="currentColor" d="M19 17H10l2.8 2.8-1.4 1.2L6 16.6 11.4 11l1.4 1.2L10 15h9z" opacity=".9"></path>
    </svg>`;

  const icon = isLoop ? svgLoop : svgOutBack; // ako nije loop, tretiramo kao povratnu

  return `<span class="route-badge" role="img" aria-label="${labelHR}" title="${labelHR}">${icon}</span>`;
}
  
  /* =========================================================
     #10.7 KARTICE (air/drive čip)
     ========================================================= */
  function cardHTML(t){
    const diffKm = classifyByKm(t.distanceKm);
    const diffEl = classifyByElev(t.elevationM);

    const shown = (typeof t._distShownKm === 'number') ? t._distShownKm : null;
    const chipLabel = (filterState.distanceMode === 'drive') ? 'km vožnje' : 'km od vas';
    const distChip = (distancesEnabled && shown != null)
      ? `<span class="dist-chip">${shown.toFixed(1)} ${chipLabel}</span>`
      : '';

       const areaFooter = (t.area || t.mountain)
  ? `<div class="card-footer">${t.area || t.mountain}</div>`
  : '';

    return `
      <a href="staze/${t.slug}.html" class="trail-card" data-id="${t.id}">
      <img src="${t.thumbnail}" alt="${t.alt || t.name}" loading="lazy"/>
    <div class="pad">
    <div class="title-line">
      <h3>${t.name}</h3>
      ${distChip}
    </div>

    <div class="metric-row">
      <span class="metric-label">Duljina</span>
      <span class="metric-value">${t.distanceKm} km</span>
      <span class="diff-pill ${diffKm}" title="Ocjena težine po km">${DIFF_LABELS[diffKm]}</span>
    </div>

    <div class="metric-row">
      <span class="metric-label">m/nv</span>
      <span class="metric-value">${t.elevationM} m</span>
      <span class="diff-pill ${diffEl}" title="Ocjena težine po usponu">${DIFF_LABELS[diffEl]}</span>
    </div>

      <div class="metric-row route-row">
  <span class="metric-label">Trajanje</span>
  <span class="metric-value">${formatHMM(t.durationH)}</span>
  <span class="pill-right">${routeBadgeHTML(t.routeType)}</span>
</div>

    <p class="card-desc">${t.description || ''}</p>
    ${areaFooter}

    <!-- CTA badge dolje desno -->
    <span class="card-cta-bottom">
      ${currentLang==='hr' ? 'klik za više' : 'tap for details'}
    </span>
  </div>
</a>
    `;
  }
  function renderTrails(list){
    const host=document.getElementById('trail-list');
    host.innerHTML = list.map(cardHTML).join('') || `<p style="opacity:.8">Nema rezultata za odabrane filtere.</p>`;
  }

  /* =========================================================
     #10.8 FILTRIRANJE (drive/air podrška)
     ========================================================= */
   // === SORT "lakše → teže" (poštuje durationH; inače procjena) ===
function effortHours(t) {
  if (typeof t.durationH === 'number') return t.durationH;
  if (typeof t.durationH === 'string') {
    const v = parseFloat(t.durationH.replace(',', '.'));
    if (!Number.isNaN(v)) return v;
  }
  // Procjena ako nema trajanja: 1h/4km + 1h/500m uspona
  const km = typeof t.distanceKm === 'number' ? t.distanceKm : 0;
  const up = typeof t.elevationM === 'number' ? t.elevationM : 0;
  return (km / 4) + (up / 500);
}

// Primarni ključ: effortHours (manje = lakše)
// Tie-breakeri: manji uspon → kraća km → (ako oboje isto) bliže → alfabet
function byEase(a, b) {
  const ea = effortHours(a);
  const eb = effortHours(b);
  if (ea !== eb) return ea - eb;

  const ua = (typeof a.elevationM === 'number') ? a.elevationM : Number.MAX_SAFE_INTEGER;
  const ub = (typeof b.elevationM === 'number') ? b.elevationM : Number.MAX_SAFE_INTEGER;
  if (ua !== ub) return ua - ub;

  const ka = (typeof a.distanceKm === 'number') ? a.distanceKm : Number.MAX_SAFE_INTEGER;
  const kb = (typeof b.distanceKm === 'number') ? b.distanceKm : Number.MAX_SAFE_INTEGER;
  if (ka !== kb) return ka - kb;

  // ako su dvije ture “jednako teške”, koristi udaljenost kao dodatni tie-breaker
  const da = (typeof a._distShownKm === 'number') ? a._distShownKm : Number.MAX_SAFE_INTEGER;
  const db = (typeof b._distShownKm === 'number') ? b._distShownKm : Number.MAX_SAFE_INTEGER;
  if (da !== db) return da - db;

  return String(a.name || '').localeCompare(String(b.name || ''));
}

    // === POMOĆNI PARSERI I KOMPARATORI (km/mnv) ===
function num(v, d = 1e12) {
  if (typeof v === 'number') return v;
  if (typeof v === 'string') {
    const n = parseFloat(v.replace(',', '.'));
    return Number.isFinite(n) ? n : d;
  }
  return d;
}

// A B po km, pa po mnv, pa fallback na byEase (stabilno)
function byKmThenMnv(a, b) {
  const ak = num(a.distanceKm), bk = num(b.distanceKm);
  if (ak !== bk) return ak - bk;
  const am = num(a.elevationM), bm = num(b.elevationM);
  if (am !== bm) return am - bm;
  return byEase(a, b);
}

// A B samo po km (uz fallback)
function byKm(a, b) {
  const ak = num(a.distanceKm), bk = num(b.distanceKm);
  if (ak !== bk) return ak - bk;
  return byEase(a, b);
}

// A B samo po mnv (uz fallback)
function byMnv(a, b) {
  const am = num(a.elevationM), bm = num(b.elevationM);
  if (am !== bm) return am - bm;
  return byEase(a, b);
}

// A B po _distShownKm (udaljenost), uz fallback
function byDistance(a, b) {
  const ad = typeof a._distShownKm === 'number' ? a._distShownKm : 1e12;
  const bd = typeof b._distShownKm === 'number' ? b._distShownKm : 1e12;
  if (ad !== bd) return ad - bd;
  return byEase(a, b);
}
  
  function matchesDuration(t,b){ if(!b) return true; const d=t.durationH||0; if(b==='>10') return d>10; return d <= parseFloat(b); }
  function matchesArea(t,a){ if(!a) return true; return t.area===a || t.mountain===a; }
  function matchesPOI(t,q){
    if(!q) return true;
    const s=norm(q);
    const hay=[t.name,t.area,t.mountain,t.routeType,...(t.tags||[]),...(t.destinations||[])].map(norm).join(' • ');
    return hay.includes(s);
  }
  function matchesDifficulty(t, chosen, modeKm, modeElev) {
    if (!chosen) return true;
    const kmClass   = classifyByKm(t.distanceKm) ?? null;
    const elevClass = classifyByElev(t.elevationM) ?? null;
    if (modeKm && modeElev) {
      if (kmClass == null && elevClass == null) return true;
      return (kmClass === chosen) || (elevClass === chosen);
    }
    if (modeKm)   return (kmClass   == null) ? true : (kmClass   === chosen);
    if (modeElev) return (elevClass == null) ? true : (elevClass === chosen);
    return true;
  }

  async function matchesRadius(t, radius, mode, loc){
    if (!radius) return true;
    if (!loc) return false;
    const rKm = parseFloat(radius);

    if (mode==='air'){
      const d = haversineKm(loc.lat,loc.lon,t.startLat,t.startLon);
      return d <= rKm;
    }
    if (mode==='drive'){
      const km = await drivingDistanceKm(loc,{lat:t.startLat,lon:t.startLon});
      if (km==null){
        const dAir = haversineKm(loc.lat,loc.lon,t.startLat,t.startLon);
        return dAir <= rKm;
      }
      return km <= rKm;
    }
    const d = haversineKm(loc.lat,loc.lon,t.startLat,t.startLon);
    return d <= rKm;
  }

  async function filterList(){
    const { area, radius, duration, modeKm, modeElev, difficulty, poi, distanceMode } = filterState;

    let base = TRAILS.filter(t =>
      matchesArea(t, area) &&
      matchesDuration(t, duration) &&
      matchesPOI(t, poi) &&
      matchesDifficulty(t, difficulty, modeKm, modeElev)
    );

    if (!radius) return base;

    if (!userLocation) {
      return new Promise(resolve=>{
        ensureLocationThen((_loc)=>{
          filterList().then(resolve);
        });
      });
    }

    const results=[];
    for (const t of base){
      const ok = await matchesRadius(t, radius, distanceMode, userLocation);
      if (ok) results.push(t);
    }
    return results;
  }

  async function mapWithLimit(items, limit, mapper) {
    let i = 0;
    const out = new Array(items.length);
    const N = Math.min(limit, items.length) || 1;
    const workers = Array.from({length:N}, async () => {
      while (true) {
        const idx = i++; if (idx >= items.length) break;
        out[idx] = await mapper(items[idx], idx);
      }
    });
    await Promise.all(workers);
    return out;
  }

  async function attachDistances(list){
    if (!userLocation) return list;

    // air uvijek
    for (const t of list){
      if (typeof t.startLat==='number' && typeof t.startLon==='number'){
        t._distAirKm = haversineKm(userLocation.lat,userLocation.lon,t.startLat,t.startLon);
      } else {
        t._distAirKm = undefined;
      }
      t._distDriveKm = undefined;
    }

    if (filterState.distanceMode === 'drive') {
      await mapWithLimit(list, 4, async (t)=>{
        if (typeof t.startLat==='number' && typeof t.startLon==='number'){
          const d = await drivingDistanceKm(userLocation, {lat:t.startLat, lon:t.startLon});
          t._distDriveKm = (typeof d === 'number') ? d : null;
        }
      });
    }

    for (const t of list){
      if (filterState.distanceMode === 'drive' && typeof t._distDriveKm === 'number') {
        t._distShownKm = t._distDriveKm;
      } else {
        t._distShownKm = (typeof t._distAirKm === 'number') ? t._distAirKm : null;
      }
    }
    return list;
  }

  async function runFiltering(){
    updateFilterState(stateFromControls());
    let list = await filterList();

    if (userLocation) distancesEnabled = true;
    list = await attachDistances(list);

    // Odaberi strategiju sortiranja
const wantDistanceSort = (distanceTracking.active || Boolean(filterState.radius)) && distancesEnabled;

    // Ako korisnik cilja radijus → sortiraj po udaljenosti.
// Inače po km/mnv ovisno o uključenim checkboxovima; ako ništa — byEase.
if (wantDistanceSort) {
  list.sort(byDistance);
} else {
  const useKm   = !!filterState.modeKm;
  const useMnv  = !!filterState.modeElev;

  if (useKm && useMnv) {
    list.sort(byKmThenMnv);   // primarno km, sekundarno m/nv
  } else if (useKm) {
    list.sort(byKm);          // samo km
  } else if (useMnv) {
    list.sort(byMnv);         // samo m/nv
  } else {
    list.sort(byEase);        // fallback
  }
}

    renderTrails(list);
    renderActiveChips();
  }

  /* =========================================================
     #10.9 TABS + WIRING
     ========================================================= */

  document.querySelectorAll('.filter-tab').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.filter-tab').forEach(b=>b.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
      btn.classList.add('active');
      const id = btn.getAttribute('data-panel');
      const panel = document.getElementById(id);
      if (panel) panel.classList.add('active');

      if (id === 'panel-radius') {
  startDistanceTracking();  // odmah pokaži čip + kreni s lociranjem
    }
    });
  });

  // RESET
  document.getElementById('quickReset').addEventListener('click', () => {
    ['areaSelect', 'radiusSelect', 'durationBucket'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.value = '';
    });
    const dm = document.getElementById('distanceMode');
    if (dm) dm.value = 'air';

    const modeKmEl   = document.getElementById('modeKm');
    const modeElevEl = document.getElementById('modeElev');
    if (modeKmEl)   modeKmEl.checked = true;
    if (modeElevEl) modeElevEl.checked = true;

    const diffSel = document.getElementById('difficultySelect');
    if (diffSel) diffSel.value = '';

    const poi = document.getElementById('poiSearch');
    if (poi) poi.value = '';

    updateFilterState({
      area: '',
      radius: '',
      duration: '',
      poi: '',
      difficulty: '',
      modeKm: true,
      modeElev: true,
      distanceMode: 'air'
    });

    runFiltering();
  });

  // <!-- GLOBALNI CHANGE/INPUT (ispravljeno) -->

  document.addEventListener('change', async (e) => {
    const id = e.target.id;
    if (!id) return;

    // 0) uvijek prvo sinkroniziraj stanje iz UI-ja
    updateFilterState(stateFromControls());

    // 1) Promjena načina mjerenja udaljenosti (zračna linija ↔ vožnja)
    if (id === 'distanceMode') {
      // osiguraj lokaciju i čip; attachDistances() će izračunati _distShownKm
      startDistanceTracking();
      await runFiltering();           // odmah presloži po novom modu (najbliže → najdalje)
      return;
    }

    // 2) Promjena radijusa
    if (id === 'radiusSelect') {
      const hasRadius = !!document.getElementById('radiusSelect')?.value;
      if (hasRadius) {
        // ako još nije aktivno, pokreni praćenje (da imamo userLocation)
        if (!distanceTracking.active) startDistanceTracking();
      } else {
        // nema radijusa => ugasi distance tracking i vrati default sort (po težini)
        stopDistanceTracking({ silent: true });
      }
      await runFiltering();
      return;
    }

    // 3) Ostali filteri → normalno osvježi listu
    if (['areaSelect', 'durationBucket', 'modeKm', 'modeElev'].includes(id)) {
      await runFiltering();
      return;
    }
  });

  // Tražilice (live)
  document.addEventListener('input', (e) => {
    if (e.target.id === 'search') {
      updateFilterState({ poi: e.target.value.trim() });
      runFiltering();
    }
    if (e.target.id === 'poiSearch') {
      updateFilterState({ poi: e.target.value.trim() });
      runFiltering();
    }
  });

  // Težina (select)
  document.getElementById('difficultySelect')?.addEventListener('change', () => {
    updateFilterState(stateFromControls());
    runFiltering();
  });

  // (Preporuka: u handleru za "Osvježi" dodaj gašenje distance trackinga)
  // quickReset:
  // stopDistanceTracking({ silent: true }); // prije runFiltering

  /* =========================================================
     #10.10 INIT
     ========================================================= */
  document.addEventListener('DOMContentLoaded', ()=>{
  runFiltering();        // odmah filtriraj + sortiraj po pravilima gore
  renderActiveChips();
});



document.addEventListener('DOMContentLoaded', () => {
  const section = document.querySelector('.image-section.hero-videos');
  if (!section) return;

  const vids = Array.from(section.querySelectorAll('video.hero-video'));
  if (!vids.length) return;

  let current = vids.findIndex(v => v.classList.contains('active'));
  if (current < 0) current = 0;

  let lock = false;
  const OVERLAP_MS = 120;   // kratki overlap za mekši prijelaz
  const CLEANUP_MS = 650;   // > CSS transition (.6s) radi sigurnog cleanupa

  function playSafe(video) {
    try { video.currentTime = 0; } catch {}
    const p = video.play();
    if (p && typeof p.then === 'function') p.catch(()=>{});
  }

  function crossfadeTo(nextIndex) {
    if (lock || nextIndex === current) return;
    lock = true;

    const prev = vids[current];
    const next = vids[nextIndex];

    next.classList.add('next');   // postaje vidljiv iznad starog
    playSafe(next);

    setTimeout(() => {            // ugasi stari nakon kratkog overlap-a
      prev.classList.remove('active');
    }, OVERLAP_MS);

    setTimeout(() => {            // počisti i potvrdi novu aktivnu
      prev.pause();
      next.classList.remove('next');
      next.classList.add('active');
      current = nextIndex;
      lock = false;
    }, CLEANUP_MS);
  }

  function nextVideo() {
    const next = (current + 1) % vids.length;
    crossfadeTo(next);
  }

  // Kad jedan završi, kreni sljedeći (loop kroz listu)
  vids.forEach(v => v.addEventListener('ended', nextVideo));

  // Klik na hero odmah prebaci na sljedeći
  section.addEventListener('click', nextVideo, { passive: true });

  // Pokreni prvi
  playSafe(vids[current]);
});



  
(function addItemListJsonLd(){
  if (!window.TRAILS || !TRAILS.length) return;
  var base = (location.origin === 'null' || location.origin === 'file://')
    ? '' : location.origin.replace(/\/$/, '');
  var items = TRAILS.map(function(t, i){
    return {
      "@type": "ListItem",
      "position": i + 1,
      "name": t.name,
      "url": base + "/staze/" + t.slug + ".html"
    };
  });
  var data = {
    "@context": "https://schema.org",
    "@type": "ItemList",
    "name": "Planinarske staze",
    "itemListElement": items
  };
  var s = document.createElement("script");
  s.type = "application/ld+json";
  s.textContent = JSON.stringify(data);
  document.head.appendChild(s);
})();

  
</script>
  
             
</body>
</html>
